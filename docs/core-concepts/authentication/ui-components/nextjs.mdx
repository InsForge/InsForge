---
title: Next.js
description: Zero-configuration authentication for Next.js with built-in UI components
---

The `@insforge/nextjs` package provides **zero-configuration authentication** for Next.js applications. Authentication pages are hosted on your backend by default—no UI code needed.

## Features

- **Built-in Authentication**: Backend-hosted sign-in/sign-up pages (default)
- **Complete Components**: Pre-built `<SignIn>`, `<SignUp>`, `<UserButton>` with business logic
- **OAuth Support**: Google, GitHub, Discord, Facebook, LinkedIn, Microsoft, Apple, X, Instagram, TikTok, Spotify
- **React Hooks**: `useAuth()`, `useUser()`, `usePublicAuthConfig()`
- **Control Components**: `<SignedIn>`, `<SignedOut>`, `<Protect>`
- **Next.js Middleware**: Server-side route protection
- **TypeScript**: Full type safety

## Quick Start (Built-in Auth)

<Note>**Recommended for most use cases**: InsForge-hosted auth pages with zero UI code.</Note>

### Step 1: Install Package and Set Environment Variables

```bash
npm install @insforge/nextjs@latest
```

<Note>
  **Required Dependencies:** ```bash npm install react@^19.0.0 react-dom@^19.0.0 next@^15.0.0 ```
</Note>

```bash .env.local
NEXT_PUBLIC_INSFORGE_BASE_URL=https://your-app.region.insforge.app/
```

### Step 2: Add InsforgeProvider

Wrap your application with the `InsforgeProvider` in your root layout:

```tsx app/layout.tsx
import { InsforgeProvider } from '@insforge/nextjs';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <InsforgeProvider
          baseUrl={
            process.env.NEXT_PUBLIC_INSFORGE_BASE_URL || 'https://your-app.region.insforge.app' // Replace with your InsForge backend URL
          }
          afterSignInUrl="/dashboard"
        >
          {children}
        </InsforgeProvider>
      </body>
    </html>
  );
}
```

### Step 3: Create API Route

Create an API route to enable server-side rendering (SSR) and cookie-based authentication:

```tsx app/api/auth/route.ts
import { createAuthRouteHandlers } from '@insforge/nextjs/api';

const handlers = createAuthRouteHandlers({
  baseUrl: process.env.NEXT_PUBLIC_INSFORGE_BASE_URL || 'https://your-app.region.insforge.app', // Replace with your InsForge backend URL
  cookieName: 'insforge_token',
});

export const POST = handlers.POST;
export const GET = handlers.GET;
export const DELETE = handlers.DELETE;
```

<Info>**Why?** This route syncs auth tokens to HTTP-only cookies for server-side middleware.</Info>

### Step 4: Add Middleware

Create middleware to protect routes:

```ts middleware.ts
import { InsforgeMiddleware } from '@insforge/nextjs/middleware';

export default InsforgeMiddleware({
  baseUrl: process.env.NEXT_PUBLIC_INSFORGE_BASE_URL || 'https://your-app.region.insforge.app', // Replace with your InsForge backend URL
  publicRoutes: ['/'],
  cookieName: 'insforge_token',
});

export const config = {
  matcher: [
    '/((?!api|_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',
  ],
};
```

### Step 5: Use Hooks & Components

```tsx app/page.tsx
import { SignedIn, SignedOut, UserButton, useAuth, useUser } from '@insforge/nextjs';

export default function Home() {
  const { isSignedIn } = useAuth();
  const { user } = useUser();

  return (
    <div>
      <SignedOut>
        <a href="/sign-in">Sign In</a>
      </SignedOut>

      <SignedIn>
        <UserButton afterSignOutUrl="/" />
        <h1>Welcome, {user.email}!</h1>
      </SignedIn>
    </div>
  );
}
```

**That's it!** When users click "Sign In", they'll be redirected to your backend's auth page automatically.

---
End of instructions for AI agents
---

## How It Works

### Authentication Flow (Unified for OAuth and Email/Password)

```
1. User clicks "Sign In" → Middleware detects using built-in auth
   ↓
2. Middleware redirects : https://your-app.region.insforge.app/auth/signin?redirect=yourapp.com/you-defined-destination-after-sign-in
   ↓
3. User signs in on deployed page → Backend processes authentication
   ↓
4. Backend redirects → yourapp.com/you-defined-destination-after-sign-in?access_token=xxx&user_id=xxx
   ↓
5. Middlware & InsForge SDK will processes:
   - Extracts token from URL
   - Saves to localStorage
   - Verifies with getCurrentUser()
   - Updates Provider state
   - Syncs token to HTTP-only cookie
   ↓
6. User sees the destination page (e.g /dashboard)
```

---

## Complete Components (with Business Logic)

<Note>
  **Recommendation**: Use built-in auth pages (Quick Start) for most cases. Only create custom
  components if you need additional form fields or different workflow.
</Note>

### Custom Auth Pages

Create custom auth pages using pre-built components:

```tsx app/sign-in/page.tsx
'use client';

import { SignIn } from '@insforge/nextjs';
import { useRouter } from 'next/navigation';

export default function SignInPage() {
  const router = useRouter();

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <SignIn
        title="Welcome Back"
        subtitle="Sign in to your account"
        onError={(error) => {
          console.error('Sign in error:', error);
        }}
      />
    </div>
  );
}
```

```tsx app/sign-up/page.tsx
'use client';

import { SignUp } from '@insforge/nextjs';

export default function SignUpPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <SignUp
        title="Create Account"
        subtitle="Get started with your free account"
        onError={(error) => {
          console.error('Sign in error:', error);
        }}
      />
    </div>
  );
}
```

**Additional Auth Pages:**

```tsx
// Forgot password
import { ForgotPassword, ResetPassword, VerifyEmail } from '@insforge/nextjs';

// app/forgot-password/page.tsx
export default function ForgotPasswordPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <ForgotPassword />
    </div>
  );
}
```

<Info>
**For AI Agents**: Always use these pre-built components (`<SignIn>`, `<SignUp>`, `<ForgotPassword>`) instead of building forms from scratch. They handle OAuth, email/password validation, and SDK integration automatically.
</Info>

**SignIn Component Props:**

- `title` / `subtitle` - Custom heading text
- `onError` - Callback functions

**SignUp Component Props:** Same as SignIn.

---

## Hooks

### useAuth()

Access authentication methods and state:

```tsx
import { useAuth } from '@insforge/nextjs';

function Component() {
  const { signIn, signUp, signOut, isSignedIn, isLoaded } = useAuth();

  async function handleSignIn(email: string, password: string) {
    await signIn(email, password);
  }

  return <div>{isSignedIn && <button onClick={() => signOut()}>Sign Out</button>}</div>;
}
```

**Returns:**

- `signIn(email, password)` - Sign in user
- `signUp(email, password)` - Register new user
- `signOut()` - Sign out current user
- `isSignedIn` - Boolean auth state
- `isLoaded` - Boolean loading state

### useUser()

Access current user profile:

```tsx
import { useUser } from '@insforge/nextjs';

function UserProfile() {
  const { user, isLoaded, updateUser } = useUser();

  if (!isLoaded) return <div>Loading...</div>;
  if (!user) return <div>Not signed in</div>;

  return (
    <div>
      <p>Email: {user.email}</p>
      <p>ID: {user.id}</p>
    </div>
  );
}
```

**Returns:**

- `user` - Current user object (id, email, name?, avatarUrl?)
- `isLoaded` - Boolean loading state
- `updateUser(data)` - Update user profile

### usePublicAuthConfig()

Get your authentication config in InsForge:

```tsx
import { usePublicAuthConfig } from '@insforge/nextjs';

function SignInPage() {
  const { authConfig, isLoaded } = usePublicAuthConfig();

  if (!isLoaded) return <div>Loading...</div>;

  return (
    <div>
      <p>Available OAuth: {authConfig.oAuthProviders.join(', ')}</p>
      <p>Password min length: {authConfig?.passwordMinLength}</p>
    </div>
  );
}
```

**Returns:**

- `authConfig` - Authentication Configuration you set in InsForge dashboard.
- `isLoaded` - Boolean loading state

<Warning>
  **Performance**: Only use this hook in SignIn/SignUp components to avoid unnecessary API calls.
</Warning>

---

## Control Components

### SignedIn / SignedOut

Show/hide content based on authentication:

```tsx
import { SignedIn, SignedOut } from '@insforge/nextjs';

function NavBar() {
  return (
    <nav>
      <SignedOut>
        <a href="/sign-in">Sign In</a>
      </SignedOut>

      <SignedIn>
        <UserButton />
      </SignedIn>
    </nav>
  );
}
```

### UserButton

Pre-built user profile button with dropdown menu:

```tsx
import { UserButton } from '@insforge/nextjs';

function Header() {
  return (
    <header>
      <UserButton mode="detailed" afterSignOutUrl="/" />
    </header>
  );
}
```

**Props:**

- `mode` - Display mode: `"detailed"` (avatar + name + email) or `"simple"` (avatar only)
- `afterSignOutUrl` - Redirect URL after sign out

### Protect

Only render when the user is signed in:

```tsx
import { Protect } from '@insforge/nextjs';

// Block unauthenticated access
<Protect redirectTo='/sign-in'>
  <VerifiedUserProfile />
</Protect>

// Custom logic
<Protect
  condition={(user) => user.subscription === 'premium'}
  fallback={<UpgradePrompt />}
>
  <PremiumFeature />
</Protect>
```

---

## Advanced Features

### Auth Change Callback

Track authentication state changes for analytics or other side effects:

```tsx app/layout.tsx
<InsforgeProvider
  baseUrl={baseUrl}
  onAuthChange={(user) => {
    if (user) {
      // User signed in
      console.log('User signed in:', user.email);
      analytics.identify(user.id);
    } else {
      // User signed out
      console.log('User signed out');
      analytics.reset();
    }
  }}
>
  {children}
</InsforgeProvider>
```
