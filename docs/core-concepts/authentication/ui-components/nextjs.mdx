---
title: Next.js
description: Zero-configuration authentication for Next.js with built-in UI components
---

The `@insforge/nextjs` package provides **zero-configuration authentication** for Next.js applications. Authentication pages are hosted on your backend by default—no UI code needed.

<Tip>
**For AI Agents - Quick Navigation:**
- **Built-in auth (recommended)**: Follow [Quick Start](#quick-start-built-in-auth) → 5-minute setup with backend-hosted auth pages
- **Custom UI needed**: Jump to [Advanced Usage](#advanced-usage) for custom components
- **Styling only**: See [Styling Components](#styling-components)
- **Full control**: See [Primitive Components](#primitive-components)

**Key principle**: Always use `@insforge/sdk` methods with these components. Never use raw `fetch` calls.
</Tip>

## Why Built-in Auth?

<CardGroup cols={2}>
  <Card title="Zero UI Code" icon="code">
    No SignIn/SignUp pages to create
  </Card>
  
  <Card title="5-Minute Setup" icon="clock">
    Provider + API route + callback page = done
  </Card>
  
  <Card title="Production Ready" icon="shield-check">
    Battle-tested auth UI maintained by Insforge
  </Card>
  
  <Card title="Auto OAuth" icon="key">
    11 providers configured automatically from backend
  </Card>
</CardGroup>

<Note>
Use custom components only if you need highly customized branding or custom fields.
</Note>

## Features

- **Built-in Authentication**: Backend-hosted sign-in/sign-up pages (default)
- **OAuth Support**: Google, GitHub, Discord, Facebook, LinkedIn, Microsoft, Apple, X, Instagram, TikTok, Spotify
- **React Hooks**: `useAuth()`, `useUser()`, `useSession()`
- **Control Components**: `<SignedIn>`, `<SignedOut>`, `<Protect>`
- **Next.js Middleware**: Server-side route protection
- **TypeScript**: Full type safety

## Installation

```bash
npm install @insforge/nextjs @insforge/sdk
```

<Note>
**SDK Integration**: `@insforge/nextjs` works seamlessly with `@insforge/sdk`. The SDK handles API calls, token management, and OAuth callback detection automatically. Always use SDK methods instead of raw `fetch` calls.
</Note>

## Quick Start (Built-in Auth)

<Note>
**Recommended for most use cases**: InsForge-hosted auth pages with zero UI code. Switch to [Advanced Usage](#advanced-usage) only if you need custom branding or additional form fields.
</Note>

### Step 1: Add InsforgeProvider

Wrap your application with the `InsforgeProvider` in your root layout:

```tsx app/layout.tsx
import { InsforgeProvider } from '@insforge/nextjs';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <InsforgeProvider baseUrl={process.env.NEXT_PUBLIC_INSFORGE_BASE_URL!}>
          {children}
        </InsforgeProvider>
      </body>
    </html>
  );
}
```

### Step 2: Create API Route

Create an API route to enable server-side rendering (SSR) and cookie-based authentication:

```tsx app/api/auth/route.ts
import { createAuthRouteHandlers } from '@insforge/nextjs/api';

const handlers = createAuthRouteHandlers({
  baseUrl: process.env.INSFORGE_BASE_URL || process.env.NEXT_PUBLIC_INSFORGE_BASE_URL!,
  cookieName: 'insforge_token',
});

export const POST = handlers.POST;
export const GET = handlers.GET;
export const DELETE = handlers.DELETE;
```

<Info>
**Why?** This route syncs auth tokens to HTTP-only cookies for server-side middleware.
</Info>

### Step 3: Create Callback Page

<Warning>
**Critical:** The callback page is essential for authentication to work. It handles OAuth and email/password returns from InsForge-hosted auth pages.
</Warning>

```tsx app/auth/callback/page.tsx
'use client';

import { useEffect, useRef, Suspense } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import { createClient } from '@insforge/sdk';

function CallbackContent() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const isProcessingRef = useRef(false);

  useEffect(() => {
    const processCallback = async () => {
      if (isProcessingRef.current) return;
      isProcessingRef.current = true;

      const error = searchParams.get('error');
      if (error) {
        router.push('/?error=' + encodeURIComponent(error));
        return;
      }

      // SDK automatically detects and stores URL parameters
      const insforge = createClient({
        baseUrl: process.env.NEXT_PUBLIC_INSFORGE_BASE_URL!,
      });

      // Fetch complete user profile
      const { data: userData, error: userError } = await insforge.auth.getCurrentUser();

      if (userError || !userData) {
        router.push('/?error=authentication_failed');
        return;
      }

      // Store user profile for instant UI updates
      localStorage.setItem('insforge-user-profile', JSON.stringify(userData));

      // Sync token to HTTP-only cookie for server-side middleware
      const token = localStorage.getItem('insforge-auth-token');
      if (token) {
        await fetch('/api/auth', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'sync-token', token }),
        });
      }

      // Clean up URL and redirect
      window.history.replaceState({}, '', '/auth/callback');
      const destination = sessionStorage.getItem('auth_destination') || '/';
      sessionStorage.removeItem('auth_destination');
      setTimeout(() => router.push(destination), 100);
    };

    processCallback();
  }, [searchParams, router]);

  return (
    <div className="flex items-center justify-center min-h-screen">
      <div className="text-center">
        <h2 className="text-2xl font-semibold mb-4">Completing authentication...</h2>
        <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
      </div>
    </div>
  );
}

export default function CallbackPage() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <CallbackContent />
    </Suspense>
  );
}
```

### Step 4: Add Middleware

Create middleware to protect routes:

```ts middleware.ts
import { InsforgeMiddleware } from '@insforge/nextjs/middleware';

export default InsforgeMiddleware({
  baseUrl: process.env.INSFORGE_BASE_URL!,
  publicRoutes: ['/auth/callback', '/'],
  cookieName: 'insforge_token',
});

export const config = {
  matcher: ['/((?!api|_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)'],
};
```

### Step 5: Use in Components

Use the provided components and hooks in your pages:

```tsx app/page.tsx
import { SignedIn, SignedOut, UserButton } from '@insforge/nextjs';

export default function Home() {
  return (
    <div>
      <SignedOut>
        <a href="/sign-in">Sign In</a>
      </SignedOut>

      <SignedIn>
        <UserButton afterSignOutUrl="/" />
        <h1>Welcome back!</h1>
      </SignedIn>
    </div>
  );
}
```

**That's it!** When users click "Sign In", they'll be redirected to your backend's auth page automatically.

## How It Works

### Authentication Flow (Unified for OAuth and Email/Password)

```
1. User clicks "Sign In" → Middleware detects no auth
   ↓
2. Redirects to: https://backend.insforge.app/auth/signin?redirect=yourapp.com/auth/callback
   ↓
3. User authenticates on backend's hosted page
   - Option A: OAuth (Google, GitHub, etc.)
   - Option B: Email + Password
   ↓
4. Backend processes authentication and redirects:
   yourapp.com/auth/callback?access_token=xxx&user_id=xxx&email=xxx&name=xxx
   ↓
5. Callback page processes:
   - Stores token in localStorage (client-side SDK)
   - Stores user profile in localStorage (instant UI)
   - Syncs token to HTTP-only cookie (server-side middleware)
   - Cleans URL (removes sensitive data)
   ↓
6. Redirects to destination → User sees /dashboard
```

<Note>
**Why API route + callback?**
- **API route** (`/api/auth`): Syncs tokens to HTTP-only cookies (enables server-side middleware protection)
- **Callback page** (`/auth/callback`): Receives tokens and user data from backend auth pages (OAuth + email/password), stores them properly, and handles redirect

**Unified Format:** Both OAuth and email/password flows return the same parameters, making the callback page simple and consistent.
</Note>

## Local Development

Backend typically runs on different port during local development:

```bash .env.local
NEXT_PUBLIC_INSFORGE_BASE_URL=        # Copy InsForge's api base url from instalation command
INSFORGE_BASE_URL=                    # Copy InsForge's api base url from instalation command
```

<Info>
The provider automatically uses `NEXT_PUBLIC_INSFORGE_FRONTEND_URL` for auth redirects if set.
</Info>

## SDK + Next.js Package Integration

<Note>
**Important**: `@insforge/nextjs` works seamlessly with `@insforge/sdk`. The SDK handles all API calls, token management, and OAuth callback detection. Always use SDK methods instead of raw `fetch` calls.
</Note>

**What SDK handles:**
- API calls to backend (`getCurrentUser()`, `signIn()`, `signUp()`, etc.)
- Token storage and management (`insforge-auth-token`, `insforge-auth-user`)
- OAuth callback parameter detection (automatic on `createClient()`)
- Type-safe responses with proper error handling

**What Next.js package handles:**
- React components (`<SignedIn>`, `<SignedOut>`, `<Protect>`, `<UserButton>`)
- React hooks (`useAuth()`, `useUser()`, `useSession()`)
- Next.js middleware for route protection
- SSR support via cookie sync

---

## Advanced Usage

<Warning>
Only use custom components if you need highly customized branding or additional form fields. Built-in auth is faster, requires zero UI code, and needs less maintenance.
</Warning>

### Custom Auth Components

Want custom branding or additional fields? Disable built-in auth and use custom components:

**Step 1: Disable built-in auth**

```tsx app/layout.tsx
import { InsforgeProvider } from '@insforge/nextjs';

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <InsforgeProvider 
          baseUrl={process.env.NEXT_PUBLIC_INSFORGE_BASE_URL!}
          useBuiltInAuth={false}
        >
          {children}
        </InsforgeProvider>
      </body>
    </html>
  );
}
```

**Step 2: Create custom auth pages**

```tsx app/sign-in/page.tsx
'use client';

import { SignIn } from '@insforge/nextjs';
import { useRouter } from 'next/navigation';

export default function SignInPage() {
  const router = useRouter();

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <SignIn
        afterSignInUrl="/dashboard"
        title="Welcome Back"
        subtitle="Sign in to your account"
        onSuccess={(user) => {
          console.log('Signed in:', user);
          router.push('/dashboard');
        }}
        onError={(error) => {
          console.error('Sign in error:', error);
        }}
      />
    </div>
  );
}
```

```tsx app/sign-up/page.tsx
'use client';

import { SignUp } from '@insforge/nextjs';

export default function SignUpPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50">
      <SignUp 
        afterSignUpUrl="/onboarding"
        title="Create Account"
        subtitle="Get started with your free account"
      />
    </div>
  );
}
```

<Info>
**For AI Agents**: Always use these pre-built components (`<SignIn>`, `<SignUp>`) instead of building forms from scratch. They handle OAuth, email/password validation, and SDK integration automatically.
</Info>

**SignIn Component Props:**
- `afterSignInUrl` - Redirect URL after successful sign in
- `title` / `subtitle` - Custom heading text
- `emailLabel` / `passwordLabel` - Custom field labels
- `submitButtonText` / `loadingButtonText` - Custom button text
- `appearance` - Tailwind CSS classes for styling
- `onSuccess` / `onError` - Callback functions

**SignUp Component Props:** Same as SignIn, plus:
- `afterSignUpUrl` - Redirect URL after successful sign up
- Additional text customization options

### Styling Components

All components support an `appearance` prop for Tailwind CSS customization:

```tsx
<SignIn
  appearance={{
    containerClassName: "shadow-2xl",
    cardClassName: "bg-white border-2 border-gray-200",
    buttonClassName: "bg-blue-600 hover:bg-blue-700",
    inputClassName: "border-gray-300 focus:border-blue-500"
  }}
/>

<UserButton
  mode="detailed"
  appearance={{
    containerClassName: "ml-auto",
    buttonClassName: "hover:bg-gray-100 rounded-lg",
    nameClassName: "text-white font-semibold",
    emailClassName: "text-gray-300 text-sm"
  }}
/>
```

**UserButton Display Modes:**
- `detailed` (default): Shows avatar + name + email
- `simple`: Shows avatar only

<Tip>
Use `appearance` prop to match your app's design system without rebuilding components from scratch.
</Tip>

### Primitive Components

For complete customization, use primitive building blocks to create your own auth forms:

```tsx
import {
  AuthContainer,
  AuthHeader,
  AuthFormField,
  AuthPasswordField,
  AuthSubmitButton,
  AuthDivider,
  AuthOAuthProviders,
  AuthLink,
  cn,
} from '@insforge/nextjs';

function CustomSignIn() {
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    // Your custom sign-in logic with SDK
  };

  return (
    <AuthContainer
      appearance={{
        containerClassName: "max-w-md",
        cardClassName: "bg-white shadow-xl"
      }}
    >
      <AuthHeader
        title="Welcome Back"
        subtitle="Sign in to continue"
        appearance={{
          titleClassName: "text-3xl text-blue-900",
          subtitleClassName: "text-gray-600"
        }}
      />

      <form onSubmit={handleSubmit}>
        <AuthFormField
          id="email"
          type="email"
          label="Email Address"
          placeholder="you@example.com"
          appearance={{
            labelClassName: "text-gray-700 font-medium",
            inputClassName: "border-blue-500 focus:ring-blue-500"
          }}
        />

        <AuthPasswordField
          id="password"
          label="Password"
          appearance={{
            inputClassName: "border-blue-500"
          }}
        />

        <AuthSubmitButton
          isLoading={loading}
          className="bg-blue-600 hover:bg-blue-700 w-full"
        >
          Sign In
        </AuthSubmitButton>
      </form>

      <AuthDivider text="or continue with" />

      <AuthOAuthProviders
        providers={['google', 'github']}
        onClick={handleOAuth}
        appearance={{
          buttonClassName: "hover:bg-gray-50 border-gray-300"
        }}
      />

      <AuthLink
        text="Don't have an account?"
        linkText="Sign up"
        href="/sign-up"
        appearance={{
          containerClassName: "text-center",
          linkClassName: "text-blue-600 hover:underline"
        }}
      />
    </AuthContainer>
  );
}
```

**Available Primitive Components:**
- `AuthContainer` - Main form container with responsive layout
- `AuthHeader` - Title and subtitle section
- `AuthFormField` - Standard input field with label
- `AuthPasswordField` - Password field with visibility toggle
- `AuthPasswordStrengthIndicator` - Password requirement checklist
- `AuthSubmitButton` - Submit button with loading states
- `AuthErrorBanner` - Error message display banner
- `AuthDivider` - Visual separator with text
- `AuthOAuthProviders` - OAuth provider buttons grid
- `AuthOAuthButton` - Individual OAuth provider button
- `AuthVerificationCodeInput` - OTP/2FA code input
- `AuthLink` - Navigation link with styling
- `AuthBranding` - Insforge branding footer

<Note>
All primitive components support the `appearance` prop with specific `className` options for each element, allowing complete styling control while maintaining consistent behavior.
</Note>

### Conditional Rendering

Use the `<Protect>` component for custom access control logic:

```tsx
import { Protect } from '@insforge/nextjs';

// Role-based access
<Protect condition={(user) => user.role === 'admin'}>
  <AdminPanel />
</Protect>

// Email verification check
<Protect condition={(user) => user.emailVerified}>
  <VerifiedUserFeature />
</Protect>

// Custom logic
<Protect 
  condition={(user) => user.subscription === 'premium'}
  fallback={<UpgradePrompt />}
>
  <PremiumFeature />
</Protect>
```

### Auth Change Callback

Track authentication state changes for analytics or other side effects:

```tsx app/layout.tsx
<InsforgeProvider
  baseUrl={baseUrl}
  onAuthChange={(user) => {
    if (user) {
      // User signed in
      console.log('User signed in:', user.email);
      analytics.identify(user.id);
    } else {
      // User signed out
      console.log('User signed out');
      analytics.reset();
    }
  }}
>
  {children}
</InsforgeProvider>
```

---

## React Hooks

### useAuth()

Access authentication methods and state:

```tsx
import { useAuth } from '@insforge/nextjs';

function Component() {
  const { signIn, signUp, signOut, isSignedIn, isLoaded } = useAuth();
  
  async function handleSignIn(email: string, password: string) {
    await signIn(email, password);
  }
  
  return (
    <div>
      {isSignedIn && <button onClick={() => signOut()}>Sign Out</button>}
    </div>
  );
}
```

**Returns:**
- `signIn(email, password)` - Sign in user
- `signUp(email, password)` - Register new user
- `signOut()` - Sign out current user
- `isSignedIn` - Boolean auth state
- `isLoaded` - Boolean loading state

### useUser()

Access current user profile:

```tsx
import { useUser } from '@insforge/nextjs';

function UserProfile() {
  const { user, isLoaded, updateUser } = useUser();
  
  if (!isLoaded) return <div>Loading...</div>;
  if (!user) return <div>Not signed in</div>;
  
  return (
    <div>
      <p>Email: {user.email}</p>
      <p>ID: {user.id}</p>
    </div>
  );
}
```

**Returns:**
- `user` - Current user object (id, email, nickname, avatarUrl, role, emailVerified)
- `isLoaded` - Boolean loading state
- `updateUser(data)` - Update user profile

### useSession()

Access session information:

```tsx
import { useSession } from '@insforge/nextjs';

function SessionInfo() {
  const { session, isLoaded } = useSession();
  
  if (!session) return <div>No active session</div>;
  
  return <div>User ID: {session.userId}</div>;
}
```

**Returns:**
- `session` - Current session (userId, token, expiresAt, createdAt)
- `isLoaded` - Boolean loading state

## Control Components

### SignedIn / SignedOut

Show/hide content based on authentication:

```tsx
import { SignedIn, SignedOut } from '@insforge/nextjs';

function NavBar() {
  return (
    <nav>
      <SignedOut>
        <a href="/sign-in">Sign In</a>
      </SignedOut>

      <SignedIn>
        <UserButton />
      </SignedIn>
    </nav>
  );
}
```

### UserButton

Pre-built user profile button with dropdown menu:

```tsx
import { UserButton } from '@insforge/nextjs';

function Header() {
  return (
    <header>
      <UserButton 
        mode="detailed"
        afterSignOutUrl="/" 
      />
    </header>
  );
}
```

**Props:**
- `mode` - Display mode: `"detailed"` (avatar + name + email) or `"simple"` (avatar only)
- `afterSignOutUrl` - Redirect URL after sign out
- `appearance` - Tailwind classes for styling

### Protect

Conditional rendering with custom logic (see [Conditional Rendering](#conditional-rendering) in Advanced Usage for examples)

## Server-Side Access

Access auth data in Server Components using middleware helpers:

```tsx app/dashboard/page.tsx
import { headers } from 'next/headers';
import { getAuthUserId, getAuthToken } from '@insforge/nextjs/middleware';
import { createClient } from '@insforge/sdk';

export default async function Dashboard() {
  const userId = getAuthUserId(headers());
  const token = getAuthToken(headers());
  
  if (!userId) {
    return <div>Not authenticated</div>;
  }
  
  // Create SDK client with token for server-side API calls
  const insforge = createClient({
    baseUrl: process.env.INSFORGE_BASE_URL!,
    edgeFunctionToken: token || undefined,
  });
  
  const { data: userData } = await insforge.auth.getCurrentUser();
  
  return <div>Welcome, {userData?.user.email}</div>;
}
```

**Available helpers:**
- `getAuthUserId(headers())` - Returns user ID or null
- `getAuthToken(headers())` - Returns auth token or null

## Why @insforge/nextjs?

<CardGroup cols={2}>
  <Card title="For Developers" icon="user">
    5-minute auth setup vs hours of custom code. Production-ready security and OAuth support out of the box.
  </Card>
  
  <Card title="For AI Agents" icon="robot">
    Minimal code generation (5 files vs 20+). SDK-first approach ensures type safety and reduces errors.
  </Card>
</CardGroup>

<Note>
**Key Principle**: This package works with `@insforge/sdk`. Always use SDK methods for API calls—never raw `fetch`. Components handle UI, SDK handles data.
</Note>

## Resources

<CardGroup cols={3}>
  <Card title="Documentation" icon="book" href="https://docs.insforge.dev/introduction">
    Full documentation
  </Card>
  
  <Card title="GitHub Issues" icon="github" href="https://github.com/InsForge/InsForge/issues">
    Report bugs & request features
  </Card>
  
  <Card title="Discord Community" icon="discord" href="https://discord.com/invite/DvBtaEc9Jz">
    Get help & share feedback
  </Card>
</CardGroup>

